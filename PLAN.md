# План реализации Telegram бота для мониторинга вакансий

## Обзор проекта
Telegram бот для мониторинга вакансий с сайта gsz.gov.by и других сайтов трудоустройства в Беларуси, с возможностью фильтрации, экспорта данных и уведомлений о новых вакансиях.

**Особенности проекта:**
- ✅ Бюджетный хостинг (до $5/мес)
- ✅ Мультипользовательский режим
- ✅ Профессиональная архитектура
- ✅ Масштабируемость и расширяемость
- ✅ Качественный код с лучшими практиками

## Архитектура системы

### 1. Технологический стек (профессиональный подход)
- **Язык**: Python 3.11+
- **Telegram Bot API**: python-telegram-bot (асинхронная версия) или aiogram 3.x
  - Асинхронный подход для лучшей производительности
  - Поддержка современных возможностей Telegram API
- **Парсинг**: 
  - BeautifulSoup4 для HTML парсинга
  - aiohttp для асинхронных HTTP запросов
  - Selenium/Playwright (если нужен JS рендеринг)
- **База данных**: 
  - SQLite для начала (легко перейти на PostgreSQL)
  - PostgreSQL при росте нагрузки (поддержка через SQLAlchemy)
- **ORM**: SQLAlchemy 2.0+ (современный подход с type hints)
- **Планировщик задач**: APScheduler (асинхронный режим)
- **Экспорт в Excel**: openpyxl или pandas (для сложных операций)
- **Логирование**: structlog или logging с настройкой
- **Конфигурация**: pydantic-settings для валидации настроек
- **Тестирование**: pytest, pytest-asyncio
- **Линтинг**: ruff, mypy для проверки типов

### 1.1. Рекомендуемые хостинги (до $5/мес)

#### Вариант 1: VPS серверы (рекомендуется для нескольких пользователей)
- **Hetzner Cloud** (€4/мес ≈ $4.5) - 2GB RAM, 20GB SSD, лучший вариант по цене/качеству
- **Vultr** ($2.50-5/мес) - 1-2GB RAM, хорошая производительность
- **DigitalOcean** ($4/мес) - 512MB RAM (может быть мало), но надежный
- **Timeweb VPS** (~200-300 руб/мес ≈ $2-3) - российский хостинг, удобно для СНГ
- **Reg.ru VPS** (~200-300 руб/мес ≈ $2-3) - российский хостинг

**Преимущества VPS:**
- Полный контроль над сервером
- Можно установить PostgreSQL при необходимости
- Нет ограничений на количество пользователей
- Можно настроить автоматические бэкапы

#### Вариант 2: Платформы как сервис (PaaS)
- **Railway.app** ($5/мес) - простой деплой, автоматические обновления
- **Render** ($7/мес) - чуть дороже, но очень простой
- **PythonAnywhere Hacker** ($5/мес) - но ограничен одним пользователем

**Рекомендация**: **Hetzner Cloud** или **Timeweb VPS** - лучший баланс цены и функциональности для нескольких пользователей

### 2. Структура проекта (профессиональная архитектура)
```
Telegram_bot_Alexandr/
├── bot/
│   ├── __init__.py
│   ├── main.py              # Точка входа приложения
│   ├── application.py       # Основной класс бота
│   ├── handlers/            # Обработчики команд и сообщений
│   │   ├── __init__.py
│   │   ├── start.py         # Команда /start, регистрация
│   │   ├── search.py        # Поиск вакансий
│   │   ├── filters.py       # Управление фильтрами
│   │   ├── monitoring.py   # Управление мониторингом
│   │   ├── export.py        # Экспорт данных
│   │   ├── admin.py         # Административные команды
│   │   └── errors.py        # Обработка ошибок
│   ├── middlewares/         # Middleware для бота
│   │   ├── __init__.py
│   │   ├── logging.py      # Логирование запросов
│   │   └── user.py          # Проверка пользователей
│   └── keyboards.py         # Клавиатуры и кнопки
├── parsers/
│   ├── __init__.py
│   ├── base_parser.py       # Базовый абстрактный класс парсера
│   ├── gsz_parser.py        # Парсер gsz.gov.by
│   ├── praca_parser.py      # Парсер praca.by
│   ├── rabota_parser.py     # Парсер rabota.by
│   └── belrabota_parser.py  # Парсер belrabota.by
├── database/
│   ├── __init__.py
│   ├── base.py              # Базовые настройки БД
│   ├── session.py           # Управление сессиями
│   ├── models.py            # SQLAlchemy модели
│   └── repositories/        # Репозитории для работы с данными
│       ├── __init__.py
│       ├── user_repository.py
│       ├── vacancy_repository.py
│       ├── filter_repository.py
│       └── monitoring_repository.py
├── services/
│   ├── __init__.py
│   ├── monitoring_service.py    # Сервис мониторинга вакансий
│   ├── filter_service.py         # Сервис фильтрации
│   ├── export_service.py         # Сервис экспорта в Excel
│   ├── notification_service.py   # Сервис уведомлений
│   └── parser_service.py         # Сервис управления парсерами
├── schemas/                 # Pydantic схемы для валидации
│   ├── __init__.py
│   ├── user.py
│   ├── vacancy.py
│   ├── filter.py
│   └── monitoring.py
├── config/
│   ├── __init__.py
│   ├── settings.py          # Настройки приложения (pydantic)
│   └── logging_config.py    # Конфигурация логирования
├── utils/
│   ├── __init__.py
│   ├── helpers.py           # Вспомогательные функции
│   ├── validators.py        # Валидаторы данных
│   └── exceptions.py        # Кастомные исключения
├── tests/                   # Тесты
│   ├── __init__.py
│   ├── conftest.py
│   ├── test_parsers/
│   ├── test_services/
│   └── test_handlers/
├── alembic/                 # Миграции БД
│   ├── versions/
│   └── env.py
├── requirements.txt
├── requirements-dev.txt     # Зависимости для разработки
├── .env.example
├── .gitignore
├── pyproject.toml           # Конфигурация проекта
├── README.md
├── PLAN.md
└── ТЗ
```

**Особенности архитектуры:**
- Четкое разделение ответственности (handlers, services, repositories)
- Использование репозиториев для работы с БД (паттерн Repository)
- Сервисный слой для бизнес-логики
- Pydantic схемы для валидации данных
- Middleware для перехвата и обработки запросов
- Структурированное логирование
- Тестирование на всех уровнях
- Миграции БД через Alembic

## Этапы разработки

### Этап 1: Базовая инфраструктура
**Цель**: Настроить основу проекта

1.1. Создать структуру проекта
- Инициализировать Python проект
- Создать виртуальное окружение
- Настроить requirements.txt

1.2. Настройка конфигурации
- Создать файл .env для хранения токенов
- Настроить config/settings.py для загрузки переменных окружения
- Получить токен бота от @BotFather

1.3. База данных (профессиональный подход)
- Использовать SQLAlchemy 2.0+ с современным синтаксисом
- Создать модели данных в database/models.py:
  - User (пользователи бота)
  - Vacancy (вакансии)
  - Filter (фильтры пользователей)
  - MonitoringTask (задачи мониторинга)
  - UserSession (сессии пользователей для статистики)
- Настроить database/base.py для инициализации БД
- Настроить database/session.py для управления сессиями (dependency injection)
- Настроить Alembic для миграций БД
- Создать репозитории для работы с данными (паттерн Repository)
- Поддержка как SQLite, так и PostgreSQL через конфигурацию
- Настроить connection pooling для оптимизации

### Этап 2: Парсер для gsz.gov.by
**Цель**: Реализовать парсинг вакансий с основного сайта

2.1. Исследование сайта
- Изучить структуру страниц gsz.gov.by
- Определить API endpoints (если есть)
- Проанализировать структуру HTML страниц
- Проверить необходимость использования Selenium

2.2. Реализация базового парсера
- Создать абстрактный базовый класс BaseParser с методами:
  - `parse_vacancies()` - основной метод парсинга
  - `parse_vacancy_detail()` - парсинг детальной информации
  - `get_total_pages()` - определение количества страниц
  - `build_search_url()` - построение URL для поиска
- Реализовать GszParser с полной функциональностью:
  - Асинхронный парсинг через aiohttp
  - Извлечение всех полей: дата, организация, адрес, специальность, количество мест, зарплата, контакты
  - Обработка пагинации
  - Retry механизм с экспоненциальной задержкой
  - Обработка различных форматов данных
  - Валидация данных через Pydantic схемы
  - Логирование всех операций
  - Кэширование запросов (опционально)

2.3. Тестирование парсера
- Написать unit тесты для всех методов парсера
- Написать integration тесты с mock данными
- Проверить извлечение всех полей
- Проверить обработку edge cases (пустые данные, ошибки сети, измененная структура)
- Написать тесты для retry механизма
- Использовать pytest fixtures для тестовых данных

### Этап 3: Базовая функциональность Telegram бота
**Цель**: Реализовать основные команды бота с профессиональным подходом

3.1. Инициализация бота
- Настроить python-telegram-bot (асинхронная версия) или aiogram 3.x
- Создать класс Application в bot/application.py
- Настроить middleware для логирования и обработки ошибок
- Реализовать команду /start с регистрацией пользователя
- Создать главное меню с inline клавиатурой
- Настроить обработку ошибок и исключений
- Добавить rate limiting для защиты от злоупотреблений

3.2. Команды поиска
- /search - поиск вакансий по критериям
- Реализовать FSM (Finite State Machine) для интерактивного ввода:
  - Профессия
  - Город/область
  - Название организации
  - Дополнительные фильтры (зарплата, дата размещения)
- Пагинация результатов с inline кнопками
- Кэширование результатов поиска
- Форматирование результатов с использованием HTML разметки
- Обработка пустых результатов

3.3. Управление фильтрами
- /filters - просмотр сохраненных фильтров с пагинацией
- /add_filter - добавление нового фильтра через FSM
- /edit_filter - редактирование существующего фильтра
- /delete_filter - удаление фильтра с подтверждением
- /filter_activate - активация/деактивация фильтра
- Валидация данных фильтров через Pydantic схемы

### Этап 4: Система мониторинга (профессиональная реализация)
**Цель**: Реализовать автоматический мониторинг новых вакансий

4.1. Планировщик задач
- Настроить APScheduler в асинхронном режиме
- Реализовать MonitoringService для управления задачами:
  - Динамическое добавление/удаление задач
  - Поддержка множественных задач мониторинга
  - Настройка интервалов (1 час, 3 часа, 6 часов, 12 часов, 24 часа)
  - Graceful shutdown при остановке бота
- Сохранение состояния задач в БД
- Восстановление задач при перезапуске бота
- Мониторинг здоровья задач (health checks)
- Логирование всех операций планировщика

4.2. Обнаружение новых вакансий
- Реализовать алгоритм сравнения вакансий:
  - По external_id + source (основной способ)
  - По хешу содержимого (fallback для сайтов без ID)
  - Дедупликация по ключевым полям
- Сохранение только новых вакансий в БД
- Отслеживание изменений существующих вакансий (обновление данных)
- Обработка удаленных вакансий (опционально)
- Batch обработка для оптимизации

4.3. Сервис уведомлений
- Реализовать NotificationService:
  - Очередь уведомлений для надежной доставки
  - Retry механизм для failed уведомлений
  - Rate limiting для избежания блокировок Telegram
  - Форматирование сообщений с использованием HTML
  - Группировка уведомлений (опционально)
- Фильтрация по активным фильтрам каждого пользователя
- Персонализация уведомлений
- Обработка ошибок отправки:
  - Пользователь заблокировал бота
  - Ошибки сети
  - Rate limit от Telegram
- Статистика доставки уведомлений

4.4. Команды управления мониторингом
- /monitor_start - запуск мониторинга с выбором фильтра
- /monitor_stop - остановка задачи мониторинга
- /monitor_list - список активных задач с детальной информацией
- /monitor_set_interval - установка интервала проверки
- /monitor_stats - статистика по мониторингу (найдено вакансий, отправлено уведомлений)
- Поддержка нескольких активных задач мониторинга на пользователя
- Валидация параметров через Pydantic схемы

### Этап 5: Экспорт данных (профессиональная реализация)
**Цель**: Реализовать экспорт вакансий в Excel с расширенными возможностями

5.1. Сервис экспорта
- Создать ExportService для генерации Excel файлов:
  - Использование openpyxl для создания файлов
  - Форматирование ячеек (заголовки, цвета, границы)
  - Автоматическая ширина колонок
  - Поддержка фильтров и сортировки в Excel
  - Множественные листы (по источникам или датам)
- Формат таблицы:
  - Номер по порядку
  - Дата размещения
  - Источник (gsz.gov.by, praca.by и т.д.)
  - Наименование юридического лица
  - Адрес юридического лица
  - Наименование специальности
  - Количество вакантных мест
  - Средняя зарплата
  - Контактное лицо
  - Номер телефона
  - Ссылка на вакансию
- Оптимизация для больших объемов данных (streaming)
- Обработка ошибок генерации файлов

5.2. Команды экспорта
- /export - экспорт всех вакансий пользователя
- /export_filtered - экспорт по фильтру
- /export_custom - экспорт с настройками (выбор полей, формат)
- Асинхронная генерация файлов для больших объемов
- Прогресс-бар при генерации
- Отправка файла пользователю через бота
- Очистка временных файлов после отправки

### Этап 6: Расширение на другие сайты
**Цель**: Добавить поддержку других сайтов трудоустройства

6.1. Парсеры для других сайтов
- PracaParser для praca.by:
  - Анализ структуры сайта
  - Реализация парсинга с учетом особенностей
  - Обработка различных форматов данных
- RabotaParser для rabota.by:
  - Парсинг с учетом динамического контента (если нужно)
  - Обработка API endpoints (если доступны)
- BelrabotaParser для belrabota.by:
  - Адаптация под структуру сайта
  - Обработка специфичных полей

6.2. Унификация данных
- Создать единую VacancySchema через Pydantic
- Привести данные всех парсеров к единому формату
- Обработка различий в структуре сайтов:
  - Нормализация названий городов
  - Стандартизация формата зарплаты
  - Обработка различных форматов дат
- Валидация данных перед сохранением в БД

6.3. Интеграция в бота
- ParserService для управления парсерами:
  - Регистрация парсеров
  - Выбор парсера по источнику
  - Параллельный запуск парсеров
- Выбор источника данных при поиске (один или несколько)
- Мониторинг нескольких сайтов одновременно
- Статистика по источникам

### Этап 7: Дополнительные функции и улучшения
**Цель**: Улучшение UX и функциональности

7.1. Улучшение интерфейса
- Inline клавиатуры для навигации:
  - Кнопки "Следующая страница", "Предыдущая"
  - Кнопки быстрого фильтра
  - Кнопки действий (сохранить, поделиться, экспорт)
- Callback query handlers для обработки кнопок
- FSM для многошаговых операций
- Эмодзи для улучшения UX
- Адаптивные клавиатуры в зависимости от контекста

7.2. Статистика и аналитика
- /stats - персональная статистика пользователя:
  - Количество найденных вакансий
  - Количество отправленных уведомлений
  - Активные фильтры и задачи мониторинга
  - График активности (опционально)
- Административная статистика:
  - Общее количество пользователей
  - Статистика по источникам
  - Активность пользователей
  - Производительность парсеров

7.3. Административные функции
- /admin - панель администратора:
  - Управление пользователями (просмотр, блокировка)
  - Просмотр логов
  - Управление парсерами (включение/выключение)
  - Настройки системы
  - Статистика и аналитика
- Система прав доступа (обычный пользователь / администратор)
- Логирование всех действий администратора

7.4. Дополнительные улучшения
- Логирование:
  - Структурированное логирование (structlog)
  - Ротация логов
  - Разные уровни логирования (DEBUG, INFO, WARNING, ERROR)
- Обработка ошибок:
  - Централизованная обработка исключений
  - Уведомления администратора о критических ошибках
  - Graceful degradation при ошибках парсеров
- Производительность:
  - Кэширование часто запрашиваемых данных
  - Оптимизация запросов к БД
  - Асинхронная обработка тяжелых операций
- Безопасность:
  - Валидация всех входных данных
  - Защита от SQL injection (через ORM)
  - Rate limiting для защиты от злоупотреблений
  - Санитизация пользовательского ввода

## Модель данных

### Vacancy
```python
- id: int (primary key)
- external_id: str (ID с сайта)
- source: str (gsz.gov.by, praca.by, etc.)
- date_posted: datetime
- company_name: str
- company_address: str
- position: str (специальность)
- vacancies_count: int
- salary: str
- contact_person: str
- contact_phone: str
- url: str
- created_at: datetime
- updated_at: datetime
```

### User (для нескольких пользователей)
```python
- id: int (primary key)
- telegram_id: int (unique) - ID пользователя в Telegram
- username: str (nullable) - @username
- first_name: str
- last_name: str (nullable)
- is_active: bool - активен ли пользователь
- is_admin: bool - является ли администратором
- created_at: datetime
- last_activity: datetime - последняя активность
```

### Filter (с привязкой к пользователю)
```python
- id: int (primary key)
- user_id: int (foreign key -> User) - владелец фильтра
- name: str (название фильтра)
- profession: str (nullable) - профессия для поиска
- city: str (nullable) - город/область
- company_name: str (nullable) - название компании
- is_active: bool - активен ли фильтр
- created_at: datetime
```

### MonitoringTask (задачи мониторинга для каждого пользователя)
```python
- id: int (primary key)
- user_id: int (foreign key -> User) - владелец задачи
- filter_id: int (foreign key -> Filter) - фильтр для мониторинга
- interval_hours: int (1 или 3) - интервал проверки
- last_check: datetime - время последней проверки
- is_active: bool - активна ли задача
- created_at: datetime
```

**Особенности для нескольких пользователей:**
- Каждый пользователь изолирован (видит только свои данные)
- Каждый пользователь может создать несколько фильтров
- Каждый пользователь может запустить несколько задач мониторинга
- Администратор может видеть статистику по всем пользователям

## Команды бота (для нескольких пользователей)

### Основные команды
- `/start` - начало работы с ботом, регистрация пользователя
- `/help` - справка по командам
- `/search` - поиск вакансий (поиск по всем вакансиям, но результаты персональные)
- `/filters` - управление фильтрами (только свои фильтры)
- `/monitor` - управление мониторингом (только свои задачи)
- `/export` - экспорт данных в Excel (только свои фильтрованные данные)
- `/stats` - статистика (личная статистика пользователя)

### Команды фильтров
- `/add_filter` - добавить фильтр (сохраняется для текущего пользователя)
- `/delete_filter <id>` - удалить фильтр (только свой)
- `/list_filters` - список своих фильтров
- `/edit_filter <id>` - редактировать фильтр

### Команды мониторинга
- `/monitor_start <filter_id>` - запустить мониторинг для фильтра
- `/monitor_stop <task_id>` - остановить задачу мониторинга
- `/monitor_list` - список активных задач мониторинга (только свои)
- `/monitor_set_interval <task_id> <hours>` - установить интервал проверки (1 или 3)

### Административные команды (только для админов)
- `/admin_stats` - общая статистика по всем пользователям
- `/admin_users` - список пользователей
- `/admin_logs` - просмотр логов

## Риски и решения

### Риск 1: Изменение структуры сайтов
**Решение**: 
- Использовать селекторы CSS/XPath с fallback вариантами
- Регулярное тестирование парсеров
- Логирование ошибок парсинга

### Риск 2: Блокировка IP при частых запросах
**Решение**:
- Использовать задержки между запросами
- Ротация User-Agent
- Использование прокси (при необходимости)

### Риск 3: Большой объем данных
**Решение**:
- Пагинация результатов
- Индексация в БД
- Очистка старых данных (опционально)

### Риск 4: Необходимость JavaScript рендеринга
**Решение**:
- Использование Selenium или Playwright
- Альтернативно: анализ API запросов сайта

## Приоритеты разработки (для нескольких пользователей)

### MVP (Минимально жизнеспособный продукт)
1. ✅ Система пользователей (регистрация, авторизация)
2. ✅ Парсер gsz.gov.by (основной сайт)
3. ✅ Базовая функциональность бота (поиск, фильтры)
4. ✅ Мониторинг с уведомлениями (несколько задач на пользователя)
5. ✅ Экспорт в Excel (с фильтрацией по пользователю)

### Вторая итерация
6. Парсеры для других сайтов (praca.by, rabota.by, belrabota.by)
7. Улучшение интерфейса (inline клавиатуры, пагинация)
8. Статистика для пользователей и администратора
9. Административная панель

### Особенности для нескольких пользователей:
- Изоляция данных (каждый пользователь видит только свои данные)
- Множественные фильтры и задачи мониторинга на пользователя
- Система прав доступа (обычный пользователь / администратор)
- Логирование действий пользователей

## Оценка времени разработки

- Этап 1: Базовая инфраструктура - 3-4 дня
  - Структура проекта, настройка окружения
  - БД, модели, репозитории, миграции
  - Конфигурация, логирование
  
- Этап 2: Парсер gsz.gov.by - 4-6 дней
  - Исследование сайта
  - Реализация парсера с тестами
  - Обработка ошибок и edge cases
  
- Этап 3: Базовая функциональность бота - 4-5 дней
  - Обработчики команд
  - FSM для интерактивного ввода
  - Валидация и обработка данных
  
- Этап 4: Система мониторинга - 5-6 дней
  - Планировщик задач
  - Сервис уведомлений
  - Обнаружение новых вакансий
  
- Этап 5: Экспорт данных - 2-3 дня
  - Сервис экспорта
  - Форматирование Excel файлов
  
- Этап 6: Расширение на другие сайты - 6-8 дней
  - Парсеры для других сайтов
  - Унификация данных
  
- Этап 7: Дополнительные функции - 4-5 дней
  - Улучшение интерфейса
  - Статистика и аналитика
  - Административная панель
  - Тестирование и оптимизация

**Итого**: ~28-37 дней разработки (с учетом тестирования и оптимизации)

## Следующие шаги

1. Создать структуру проекта (с разделением на модули)
2. Настроить окружение и зависимости
3. Реализовать систему пользователей и БД
4. Реализовать парсер для gsz.gov.by
5. Создать базовую версию бота с обработчиками
6. Добавить мониторинг и уведомления
7. Протестировать на реальных данных
8. Развернуть на VPS (Hetzner/Timeweb) или Railway.app

## Деплой на бюджетный хостинг (до $5/мес)

### Вариант 1: Hetzner Cloud VPS (рекомендуется) - €4/мес ≈ $4.5
**Характеристики**: 2GB RAM, 20GB SSD, 1 CPU

1. Зарегистрироваться на hetzner.com
2. Создать VPS (Cloud Server CX11)
3. Установить Ubuntu/Debian
4. Настроить SSH доступ
5. Установить Python, pip, git
6. Клонировать репозиторий
7. Установить зависимости: `pip install -r requirements.txt`
8. Настроить systemd service для автозапуска бота
9. Настроить переменные окружения
10. Запустить бота: `systemctl start telegram-bot`

**Преимущества:**
- Отличное соотношение цена/качество
- Полный контроль над сервером
- Можно установить PostgreSQL при необходимости
- Нет ограничений на пользователей
- Можно настроить автоматические бэкапы

**Настройка systemd service:**
```ini
[Unit]
Description=Telegram Bot
After=network.target

[Service]
Type=simple
User=your_user
WorkingDirectory=/path/to/bot
ExecStart=/usr/bin/python3 /path/to/bot/bot.py
Restart=always

[Install]
WantedBy=multi-user.target
```

### Вариант 2: Timeweb VPS - ~200-300 руб/мес ≈ $2-3
**Характеристики**: 1-2GB RAM, 10-20GB SSD

1. Зарегистрироваться на timeweb.com
2. Заказать VPS тариф
3. Аналогично Hetzner - установка и настройка через SSH
4. Удобно для пользователей из СНГ (поддержка на русском)

**Преимущества:**
- Дешевле чем Hetzner
- Поддержка на русском языке
- Удобная панель управления

### Вариант 3: Railway.app - $5/мес
1. Зарегистрироваться на railway.app
2. Подключить GitHub репозиторий
3. Настроить переменные окружения
4. Railway автоматически развернет бота

**Преимущества:**
- Автоматический деплой из Git
- Простая настройка
- Автоматические обновления

**Недостатки:**
- Меньше контроля над сервером
- Может быть дороже при росте трафика

### Вариант 4: Vultr - $2.50-5/мес
Аналогично Hetzner, но с другими характеристиками. Хороший вариант для США/Европы.

**Важно для всех вариантов:**
- Хранить токены в переменных окружения (.env)
- SQLite файл будет храниться на сервере (регулярные бэкапы!)
- Настроить автоматический перезапуск при падении (systemd или supervisor)
- Настроить логирование для отладки
- Рассмотреть возможность установки PostgreSQL при росте пользователей (>20)

## Технические требования и зависимости

### Зависимости проекта:

#### Основные зависимости (requirements.txt):
```
python-telegram-bot==20.7  # Асинхронная версия для Telegram Bot API
beautifulsoup4==4.12.2  # Парсинг HTML
aiohttp==3.9.1  # Асинхронные HTTP запросы
SQLAlchemy==2.0.23  # ORM для работы с БД
alembic==1.13.0  # Миграции БД
APScheduler==3.10.4  # Планировщик задач (асинхронный режим)
openpyxl==3.1.2  # Работа с Excel файлами
pydantic==2.5.0  # Валидация данных
pydantic-settings==2.1.0  # Управление настройками
python-dotenv==1.0.0  # Загрузка переменных окружения
structlog==23.2.0  # Структурированное логирование
```

#### Зависимости для разработки (requirements-dev.txt):
```
pytest==7.4.3  # Фреймворк для тестирования
pytest-asyncio==0.21.1  # Поддержка асинхронных тестов
pytest-cov==4.1.0  # Покрытие кода тестами
ruff==0.1.6  # Линтер и форматтер
mypy==1.7.1  # Проверка типов
black==23.12.0  # Форматирование кода
pre-commit==3.5.0  # Git hooks для проверки кода
```

### Архитектурные решения:

1. **База данных**
   - SQLite для начала (легко перейти на PostgreSQL)
   - SQLAlchemy 2.0+ с современным синтаксисом
   - Миграции через Alembic
   - Connection pooling для оптимизации
   - Поддержка транзакций

2. **Архитектура**
   - Модульная структура с четким разделением ответственности
   - Паттерн Repository для работы с БД
   - Сервисный слой для бизнес-логики
   - Dependency Injection для управления зависимостями
   - Middleware для перехвата запросов

3. **Пользователи**
   - Полноценная система пользователей с изоляцией данных
   - Регистрация при первом использовании
   - Система прав доступа (пользователь / администратор)
   - Статистика активности пользователей

4. **Мониторинг**
   - Асинхронный планировщик задач
   - Динамическое управление задачами
   - Восстановление задач при перезапуске
   - Health checks для мониторинга здоровья

5. **Качество кода**
   - Type hints для всех функций
   - Валидация данных через Pydantic
   - Структурированное логирование
   - Обработка ошибок и исключений
   - Тестирование на всех уровнях

### Оценка ресурсов:
- **Память**: ~200-400 МБ (зависит от количества пользователей и задач)
- **CPU**: Низкий-средний (зависит от частоты парсинга)
- **Диск**: ~100-500 МБ (код + БД + логи)
- **Сеть**: Минимальный трафик (запросы к сайтам + Telegram API)
- **Пользователи**: До 50+ активных пользователей на SQLite, неограниченно на PostgreSQL

**Вывод**: Отлично подходит для VPS до $5/мес (2GB RAM достаточно для начала!)

## Ключевые особенности профессионального подхода

| Компонент | Реализация |
|-----------|------------|
| **Архитектура** | Модульная структура с четким разделением ответственности |
| **БД** | SQLAlchemy 2.0+ с поддержкой SQLite и PostgreSQL |
| **API** | Асинхронный подход для лучшей производительности |
| **Валидация** | Pydantic схемы для всех входных данных |
| **Логирование** | Структурированное логирование (structlog) |
| **Тестирование** | Unit и integration тесты (pytest) |
| **Качество кода** | Type hints, линтеры (ruff, mypy), форматтеры (black) |
| **Миграции БД** | Alembic для версионирования схемы БД |
| **Обработка ошибок** | Централизованная обработка исключений |
| **Мониторинг** | Health checks, статистика, логирование |
| **Безопасность** | Валидация данных, защита от SQL injection, rate limiting |
| **Масштабируемость** | Готовность к переходу на PostgreSQL, горизонтальное масштабирование |
| **Хостинг** | VPS до $5/мес (Hetzner, Timeweb, Railway) |
| **Стоимость** | $2.5-5/мес |

## Рекомендации по выбору хостинга

### Для начала (рекомендуется): Hetzner Cloud CX11 - €4/мес
**Почему:**
- Лучшее соотношение цена/качество
- 2GB RAM достаточно для 10-20 пользователей
- Полный контроль над сервером
- Можно установить PostgreSQL при росте
- Надежная инфраструктура

### Альтернатива: Timeweb VPS - ~200-300 руб/мес
**Почему:**
- Дешевле для пользователей из СНГ
- Поддержка на русском языке
- Удобная панель управления
- Хорошая производительность

### Если нужен простой деплой: Railway.app - $5/мес
**Почему:**
- Автоматический деплой из Git
- Не нужно настраивать сервер вручную
- Автоматические обновления
- Простая настройка

## Лучшие практики разработки

### Стандарты кода
- **Type Hints**: Все функции должны иметь аннотации типов
- **Docstrings**: Документация для всех классов и публичных методов
- **Naming**: Следование PEP 8 для именования переменных и функций
- **Code Formatting**: Использование black для форматирования кода
- **Linting**: Ruff для проверки кода, mypy для проверки типов

### Тестирование
- **Unit Tests**: Тесты для всех сервисов и утилит
- **Integration Tests**: Тесты для парсеров с mock данными
- **Coverage**: Стремиться к покрытию кода тестами >80%
- **Test Fixtures**: Использование pytest fixtures для тестовых данных

### Обработка ошибок
- **Custom Exceptions**: Создание кастомных исключений для разных типов ошибок
- **Error Handling**: Централизованная обработка ошибок в middleware
- **Logging**: Логирование всех ошибок с контекстом
- **Graceful Degradation**: Приложение должно продолжать работать при частичных сбоях

### Безопасность
- **Input Validation**: Валидация всех входных данных через Pydantic
- **SQL Injection**: Использование ORM для защиты от SQL injection
- **Rate Limiting**: Ограничение частоты запросов от пользователей
- **Secrets Management**: Хранение токенов и паролей в переменных окружения

### Производительность
- **Async/Await**: Использование асинхронного кода для I/O операций
- **Caching**: Кэширование часто запрашиваемых данных
- **Database Optimization**: Индексы для часто используемых полей
- **Batch Processing**: Группировка операций для оптимизации

### Документация
- **README**: Подробная документация по установке и использованию
- **API Documentation**: Документация всех команд и функций бота
- **Code Comments**: Комментарии для сложной логики
- **Changelog**: Ведение истории изменений проекта

## Готовность к разработке

План готов для реализации качественного продукта:
- ✅ Профессиональная архитектура с четким разделением ответственности
- ✅ Асинхронный подход для лучшей производительности
- ✅ Полноценная система пользователей с изоляцией данных
- ✅ Бюджетный хостинг до $5/мес
- ✅ SQLite с возможностью миграции на PostgreSQL
- ✅ Тестирование и качество кода
- ✅ Масштабируемость и расширяемость

**Можно начинать разработку с Этапа 1!**

